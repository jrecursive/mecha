
/* 
 * Generated by introspectpages().
*/
var pages = {};

/*
 * Load a page by section -> article.
*/
function loadcontent(section, article) {
    $('#content').html("");
    $('#content').load(pages[section][article]["url"]);
    $('#crumbs').html(crumbs(section, article));
    renderLinks();
    prettyPrint();
};

/*
 * Build & display breadcrumbs.
*/
function crumbs(section, article) {
    $(".article-crumb").show();
    return '<ul class="breadcrumb"><li><a href="#">' +
           'Mecha Documentation' + 
           '</a> <span class="divider">/</span></li><li><a class="section-link" href="#">' +
           section +
           '</a><span class="article-crumb"><span class="divider">/</span></span></li>' + 
           '<span class="article-crumb"><li class="active">' +
           article +
           '</li></span></ul>';
}

/*
 * Render any display-time links.
*/
function renderLinks() {

    /*
     * Upon breadcrumb section link click, dynamically render
     *  a TOC for that section.
    */
    $(".section-link").each(function() {
        $(this).click(function() {
            $(".article-crumb").hide();
            var section = $(this).text();
            $("#content").load("util/section-tpl.html", function() {
                $(".section-name").text(section);
                for (page in pages[section]) {
                    console.log("page: " + page);
                    $(".section-articles").append(
                        "<li><a href='#" + page + "' class='contents-link'>" +
                            page +
                        "</a>");
                }
                $(".contents-link").each(function() {
                    $(this).click(function() {
                        var page = $(this).text();
                        console.log("loading " + section + ", " + page + ".");
                        loadcontent(section, page);
                    });
                });
            });
        });
    });
}

/* 
 * Dynamically build TOCs & links.
*/
function introspectpages() {
    $(".dropdown-toggle").each(function() {
        var section = $(this).text();
        pages[section] = {};
        $(this).next().find("a").each(function() {
            var article = $(this).text();
            var url = $(this).attr("href");
            $(this).attr("href", "#" + article);
            $(this).click(function() { 
                loadcontent(section, article);
            });
            pages[section][article] = {};
            pages[section][article]["url"] = url;
        });
    });
    console.log(pages);
}

/* 
 * Mmmmm.  Documentation.
*/
$(document).ready(function() {
    introspectpages();
    loadcontent('Getting Started', 'Overview');
    prettyPrint();
});

